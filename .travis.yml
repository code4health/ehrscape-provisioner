language: node_js
node_js:
  - "0.10"
before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - npm start > /dev/null &
  - npm run update-webdriver
  - sleep 1 # give server time to start
script:
  - node_modules/.bin/karma start karma.conf.js --no-auto-watch --single-run --reporters=dots --browsers=Firefox
  - node_modules/.bin/protractor e2e-test/protractor.conf.js --browser=firefox
deploy:
  provider: openshift
  user: dave.thompson@across.co.uk
  password:
    secure: HZDl4zfcGnpF4PfhumwvNJiP+tq4KAUGXiXyy85plbMXTAsPB7Vtjxne6B1522Yt6bED7p7wauWYw1yUIXPpWkK2Mtwi5ULlRfHjdHnaRtH98XL6IoZ54+kYrwzH7lAodU2VPRS2UxrLcqP5UeNKuJXRfVaiaepWAo2hj7gYhQGezWESjyamyA26xsv56UEGrH5FJTCI6ohNoIuqVx4XC1tyJf6PZamoIi3ci1Pl+inpX9UqQGhATBZqse2OdoP0MLE6eJicyk9zOL3nKulf1DQ81Kq+c72jorcrw5Ff0kwsGn2u3HxvsyQUlRFHrbGw8kAG5ocl7ETWlFmdpLd8+z4Dvo0OzXN+Dfkz5CDVdJRqJO7azH+VBO9dwm8wwZxabogq6okZUXlxz+8W4x5kw5Cp857VACSb0trKj6HSgYIKjFAsrzpzlHwnwGcNwIHHdd6cqYvhiieDj/4+CtH40EshqHlx6f6uK/HfZ1DMD9xRGEMpliD5VxqTuxJM636rSiym0gBBFu3tqpwD0Lo3LMKDaq9P6QwIyr3EqE+aSW1+H53IA7JYnHWjmAnQF9f3Y3UasyseUJ1DcFw8MKybhZ/xgJ6Mh8itB/IxCm+FdiCJALusxMqxaTl+Vx4CN4p+u0oh66aAzQwmP/L2EN1WxoyeuyK6/B2TO9/u2tqRc3A=
  app: provisioner
  domain: handihopd
  on:
    repo: handihealth/ehrscape-provisioner
  skip_cleanup: true
